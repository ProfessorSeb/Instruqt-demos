#!/bin/bash
set -euxo pipefail

export CTX_CLUSTER1=k3d-cluster-1
export CTX_CLUSTER2=k3d-cluster-2

# Check AuthorizationPolicies exist on both clusters
for ctx in $CTX_CLUSTER1 $CTX_CLUSTER2; do
  kubectl --context=$ctx get authorizationpolicy -n accounts deny-all || {
    fail-message "AuthorizationPolicy 'deny-all' not found in accounts namespace on $ctx"
    exit 1
  }
  kubectl --context=$ctx get authorizationpolicy -n accounts allow-from-finance || {
    fail-message "AuthorizationPolicy 'allow-from-finance' not found in accounts namespace on $ctx"
    exit 1
  }
done

echo "Authorization policies verified!"
