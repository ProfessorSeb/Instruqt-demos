#!/bin/bash
set -euxo pipefail

# Check accounts deployment exists
kubectl get deployment accounts -n accounts || {
  fail-message "The 'accounts' deployment does not exist in the accounts namespace."
  exit 1
}

# Check curl pod exists
kubectl get pod curl -n finance || {
  fail-message "The 'curl' pod does not exist in the finance namespace."
  exit 1
}

# Check pods are running
kubectl wait --for=condition=Ready pod -l app=accounts -n accounts --timeout=10s || {
  fail-message "The accounts pod is not ready."
  exit 1
}

kubectl wait --for=condition=Ready pod/curl -n finance --timeout=10s || {
  fail-message "The curl pod is not ready."
  exit 1
}

echo "Challenge 2 passed!"
