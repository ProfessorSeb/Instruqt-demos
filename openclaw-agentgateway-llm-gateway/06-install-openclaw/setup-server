#!/bin/bash
set -euo pipefail

# Restart port-forward if it died between challenges
if ! kill -0 "$(cat /tmp/port-forward.pid 2>/dev/null)" 2>/dev/null; then
  nohup kubectl port-forward deployment/agentgateway-proxy \
    -n agentgateway-system 8080:80 \
    > /tmp/port-forward.log 2>&1 &
  echo $! > /tmp/port-forward.pid
  sleep 3
fi

echo "Challenge setup complete"
