#!/bin/bash
set -euxo pipefail

# Check GatewayClass exists and is accepted
if ! kubectl get gatewayclass agentgateway &>/dev/null; then
  fail-message "AgentGateway GatewayClass not found. Did you run the Helm install?"
fi

STATUS=$(kubectl get gatewayclass agentgateway -o jsonpath='{.status.conditions[?(@.type=="Accepted")].status}' 2>/dev/null)
if [ "$STATUS" != "True" ]; then
  fail-message "GatewayClass 'agentgateway' exists but is not Accepted yet. Give it a moment and try again."
fi

# Check pod is running
RUNNING=$(kubectl get pods -n agentgateway-system --field-selector=status.phase=Running --no-headers 2>/dev/null | wc -l)
if [ "$RUNNING" -lt 1 ]; then
  fail-message "No running pods found in agentgateway-system namespace. Check: kubectl get pods -n agentgateway-system"
fi

echo "Challenge 1 check passed"
