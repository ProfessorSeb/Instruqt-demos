#!/bin/bash
set -euxo pipefail

if ! kubectl get deployment mcp-website-fetcher -n agentgateway-system &>/dev/null; then
  fail-message "MCP server deployment 'mcp-website-fetcher' not found. Please deploy the MCP server as shown in Step 2."
  exit 1
fi

if ! kubectl rollout status deployment/mcp-website-fetcher -n agentgateway-system --timeout=10s &>/dev/null; then
  fail-message "MCP server deployment 'mcp-website-fetcher' is not ready."
  exit 1
fi

if ! kubectl get agentgatewaybackend mcp-backend -n agentgateway-system &>/dev/null; then
  fail-message "AgentgatewayBackend 'mcp-backend' not found."
  exit 1
fi

if ! kubectl get httproute mcp -n agentgateway-system &>/dev/null; then
  fail-message "HTTPRoute 'mcp' not found."
  exit 1
fi

if ! kubectl get enterpriseagentgatewaypolicy mcp-jwt-auth -n agentgateway-system &>/dev/null; then
  fail-message "JWT auth policy 'mcp-jwt-auth' not found."
  exit 1
fi

echo "Challenge 7 complete!"
