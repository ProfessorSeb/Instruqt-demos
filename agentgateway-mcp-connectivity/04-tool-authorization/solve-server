#!/bin/bash
set -euxo pipefail

cat > /root/github-tool-policy.yaml << 'YAML'
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: github-read-only
  namespace: agentgateway-system
spec:
  targetRefs:
  - kind: HTTPRoute
    name: github-mcp-route
  backend:
    mcp:
      toolAuth:
        defaultAction: Deny
        rules:
        - tools:
          - "get_*"
          - "list_*"
          - "fetch"
          action: Allow
YAML
kubectl apply -f /root/github-tool-policy.yaml

cat > /root/slack-tool-policy.yaml << 'YAML'
apiVersion: agentgateway.dev/v1alpha1
kind: AgentgatewayPolicy
metadata:
  name: slack-messaging
  namespace: agentgateway-system
spec:
  targetRefs:
  - kind: HTTPRoute
    name: slack-mcp-route
  backend:
    mcp:
      toolAuth:
        defaultAction: Deny
        rules:
        - tools:
          - "list_*"
          - "get_*"
          - "send_message"
          - "fetch"
          action: Allow
        - tools:
          - "delete_*"
          action: Deny
YAML
kubectl apply -f /root/slack-tool-policy.yaml
