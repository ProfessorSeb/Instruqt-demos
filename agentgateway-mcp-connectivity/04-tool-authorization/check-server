#!/bin/bash
set -euxo pipefail

# Check tool auth policy exists
if ! kubectl -n agentgateway-system get agentgatewaypolicy mcp-tool-auth &>/dev/null; then
  fail-message "The mcp-tool-auth AgentgatewayPolicy was not found. Please create it as described."
  exit 1
fi

# Verify it has MCP authorization configured
if ! kubectl -n agentgateway-system get agentgatewaypolicy mcp-tool-auth -o yaml | grep -q "authorization"; then
  fail-message "The mcp-tool-auth policy doesn't have MCP authorization configured. Check the spec."
  exit 1
fi

echo "Tool authorization policy is configured correctly!"
