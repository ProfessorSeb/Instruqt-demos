#!/bin/bash
set -euxo pipefail
mkdir -p /root/policies

cat <<EOF > /root/policies/credential-leak.yaml
apiVersion: enterpriseagentgateway.solo.io/v1alpha1
kind: EnterpriseAgentgatewayPolicy
metadata:
  name: credential-leak-prevention
  namespace: default
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: llm-route
  backend:
    ai:
      promptGuard:
        response:
        - regex:
            action: Mask
            matches:
            - "sk-[a-zA-Z0-9]{20,}"
            - "ghp_[a-zA-Z0-9]{36}"
            - "AKIA[0-9A-Z]{16}"
            - "xoxb-[a-zA-Z0-9-]+"
EOF

kubectl apply -f /root/policies/credential-leak.yaml
