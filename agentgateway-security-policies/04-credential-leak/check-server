#!/bin/bash
set -euxo pipefail

if [ ! -f /root/policies/credential-leak.yaml ]; then
  fail-message "Credential leak policy not found at /root/policies/credential-leak.yaml. Please create it as shown in the instructions."
  exit 1
fi

if ! grep -q "credentialLeak" /root/policies/credential-leak.yaml; then
  fail-message "Policy file doesn't contain credentialLeak configuration."
  exit 1
fi

if ! grep -q "API_KEY" /root/policies/credential-leak.yaml; then
  fail-message "Policy should include API_KEY detector."
  exit 1
fi

echo "Challenge 4 complete!"
