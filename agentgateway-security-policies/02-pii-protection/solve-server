#!/bin/bash
set -euxo pipefail
mkdir -p /root/policies

cat <<EOF > /root/policies/pii-protection.yaml
apiVersion: agentgateway.solo.io/v1alpha1
kind: AgentGatewayPolicy
metadata:
  name: pii-protection
  namespace: default
spec:
  targetRefs:
    - group: gateway.networking.k8s.io
      kind: HTTPRoute
      name: llm-route
  default:
    security:
      pii:
        action: REDACT
        detectors:
          - type: SSN
          - type: EMAIL
          - type: PHONE
          - type: CREDIT_CARD
EOF

kubectl apply -f /root/policies/pii-protection.yaml 2>/dev/null || true
