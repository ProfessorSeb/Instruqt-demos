#!/bin/bash
set -euxo pipefail
mkdir -p /root/policies

cat <<EOF > /root/policies/pii-protection.yaml
apiVersion: enterpriseagentgateway.solo.io/v1alpha1
kind: EnterpriseAgentgatewayPolicy
metadata:
  name: pii-protection
  namespace: default
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: llm-route
  backend:
    ai:
      promptGuard:
        request:
        - response:
            message: "ðŸš« Rejected - PII detected in request"
          regex:
            action: Reject
            builtins:
            - CreditCard
            - Ssn
        response:
        - regex:
            builtins:
            - CreditCard
            action: Mask
EOF

kubectl apply -f /root/policies/pii-protection.yaml
