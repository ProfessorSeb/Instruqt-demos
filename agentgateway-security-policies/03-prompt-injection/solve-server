#!/bin/bash
set -euxo pipefail
mkdir -p /root/policies

cat <<EOF > /root/policies/prompt-injection.yaml
apiVersion: enterpriseagentgateway.solo.io/v1alpha1
kind: EnterpriseAgentgatewayPolicy
metadata:
  name: prompt-injection-guard
  namespace: default
spec:
  targetRefs:
  - group: gateway.networking.k8s.io
    kind: HTTPRoute
    name: llm-route
  backend:
    ai:
      promptGuard:
        request:
        - response:
            message: "ðŸš« Prompt injection detected â€” request blocked"
          regex:
            action: Reject
            matches:
            - "(?i)ignore.*previous.*instructions"
            - "(?i)you are now (DAN|evil|a system)"
            - "(?i)output.*system.*prompt"
            - "(?i)do anything now"
            - "(?i)forget.*your.*rules"
EOF

kubectl apply -f /root/policies/prompt-injection.yaml
